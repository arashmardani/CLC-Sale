<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>خرید CLC - کلای تنبل</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.8.0/dist/web3.min.js"></script>
    <script src="https://unpkg.com/@tronweb3/tronweb@latest/dist/TronWeb.js"></script>
    <style>
        body {font-family: Tahoma, sans-serif;background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);color: white;text-align: center;padding: 50px;min-height: 100vh;margin: 0;}
        .container {max-width: 520px;margin: 0 auto;background: rgba(0,0,0,0.35);padding: 50px 30px;border-radius: 24px;backdrop-filter: blur(15px);box-shadow: 0 10px 30px rgba(0,0,0,0.4);}
        h1 {font-size: 2.8em;margin-bottom: 10px;}
        .price {font-size: 2em;background: rgba(255,255,255,0.2);padding: 15px;border-radius: 15px;margin: 25px 0;}
        button {padding: 16px 50px;font-size: 1.4em;font-weight: bold;background: #ff6b6b;border: none;border-radius: 50px;color: white;cursor: pointer;margin: 12px;transition: all 0.3s;box-shadow: 0 5px 15px rgba(255,107,107,0.4);}
        button:hover:not(:disabled) {background: #ff5252;transform: translateY(-3px) scale(1.05);}
        button:disabled {background: #666;cursor: not-allowed;opacity: 0.7;}
        .wallet {margin: 30px 0;padding: 15px;background: rgba(0,0,0,0.3);border-radius: 12px;font-size: 1.1em;}
        .connected {color: #51ff51;font-weight: bold;}
        .network {font-size: 0.9em;margin-top: 8px;color: #a8ffae;}
    </style>
</head>
<body>

<div class="container">
    <h1>کلای تنبل (CLC)</h1>
    <p>اولین میم‌کوین تنبل ایران</p>
    <div class="price">فقط ۱۰ دلار</div>
    
    <div class="wallet" id="walletStatus">کیف پول متصل نیست</div>

    <button onclick="connectWallet()">اتصال کیف پول</button>
    <button onclick="buyCLC()" id="buyBtn" disabled>خرید CLC - پرداخت ۱۰ USDT</button>

    <p style="margin-top: 40px;font-size: 0.95em;opacity: 0.9;">
        پس از پرداخت موفق، توکن CLC به صورت خودکار به کیف پول شما ارسال می‌شود
    </p>
</div>

<script>
    let userAddress = null;
    let web3 = null;
    let currentNetwork = null;

    // آدرس‌های دریافت پول تو (کاملاً امن و درست)
    const RECEIVER = {
        tron: "TY7XrUK9LbRq4CWcLuiLVW9Noju2EiD1",           // آدرس ترون تو
        bsc:  "0x9626438503c8832a65ecc931b124825c417e467e", // آدرس BSC/اتریوم تو
        eth:  "0x9626438503c8832a65ecc931b124825c417e467e",
        polygon: "0x9626438503c8832a65ecc931b124825c417e467e"
    };

    async function connectWallet() {
        document.getElementById('walletStatus').innerHTML = 'در حال اتصال...';

        if (window.ethereum) {
            try {
                web3 = new Web3(window.ethereum);
                await window.ethereum.request({ method: 'eth_requestAccounts' });
                const accounts = await web3.eth.getAccounts();
                userAddress = accounts[0];
                const chainId = await web3.eth.getChainId();

                let netName = "نامشخص";
                if (chainId === 56) netName = "بایننس اسمارت چین (BSC)";
                else if (chainId === 1) netName = "اتریوم Mainnet";
                else if (chainId === 137) netName = "پالیگان";

                currentNetwork = chainId;
                document.getElementById('walletStatus').innerHTML = 
                    `<span class="connected">متصل شد (EVM)<br>${userAddress.slice(0,8)}...${userAddress.slice(-6)}</span>
                     <div class="network">شبکه: ${netName}</div>`;
                document.getElementById('buyBtn').disabled = false;
            } catch (err) {
                document.getElementById('walletStatus').innerHTML = 'اتصال لغو شد';
            }
        }
        else if (window.tronWeb && window.tronWeb.ready) {
            userAddress = window.tronWeb.defaultAddress.base58;
            currentNetwork = "tron";
            document.getElementById('walletStatus').innerHTML = 
                `<span class="connected">متصل شد (ترون)<br>${userAddress.slice(0,8)}...${userAddress.slice(-6)}</span>
                 <div class="network">شبکه: ترون (TRC20) - سریع و ارزان</div>`;
            document.getElementById('buyBtn').disabled = false;
        }
        else {
            document.getElementById('walletStatus').innerHTML = 'کیف پول پیدا نشد';
            alert('لطفاً متامسک یا تراست ولت نصب کنید');
        }
    }

    async function buyCLC() {
        if (!userAddress) return alert('اول کیف پول رو وصل کن!');

        document.getElementById('buyBtn').disabled = true;
        document.getElementById('buyBtn').textContent = 'در حال پردازش...';

        const amount = 10; // 10 USDT

        try {
            if (currentNetwork === "tron") {
                // پرداخت با ترون (TRC20)
                const contract = await window.tronWeb.contract().at("TR7NHqjeKQxGTCuuP8qACi7c5LnM5cFCCC");
                const result = await contract.transfer(
                    RECEIVER.tron,
                    amount * 1000000 // 6 decimals
                ).send({ feeLimit: 10000000 });

                alert('پرداخت موفق در شبکه ترون!\nCLC به زودی ارسال میشه');
                logPurchase(userAddress, amount, "TRON", result.txid);
            }
            else {
                // شبکه‌های EVM (BSC, ETH, Polygon)
                const chainId = currentNetwork;
                let usdtAddr, netName, receiver;

                if (chainId === 56) { usdtAddr = "0x55d398326f99059fF775485246999027B3197955"; netName = "BSC"; receiver = RECEIVER.bsc; }
                else if (chainId === 1) { usdtAddr = "0xdAC17F958D2ee523a2206206994597C13D831ec7"; netName = "Ethereum"; receiver = RECEIVER.eth; }
                else if (chainId === 137) { usdtAddr = "0xc2132D05D31c914a87C6611C10748AEb04B58e8F"; netName = "Polygon"; receiver = RECEIVER.polygon; }
                else { throw new Error("شبکه پشتیبانی نمیشه"); }

                const contract = new web3.eth.Contract([
                    {"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"transfer","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"}
                ], usdtAddr);

                const amountWei = web3.utils.toWei("10", "mwei");
                const tx = await contract.methods.transfer(receiver, amountWei).send({ from: userAddress });

                alert(`پرداخت موفق در شبکه ${netName}!\nCLC به زودی ارسال میشه`);
                logPurchase(userAddress, amount, netName, tx.transactionHash);
            }
        } catch (err) {
            alert('پرداخت ناموفق: ' + (err.message || "خطا در تراکنش"));
            console.error(err);
        }

        document.getElementById('buyBtn').disabled = false;
        document.getElementById('buyBtn').textContent = 'خرید CLC - پرداخت ۱۰ USDT';
    }

    function logPurchase(addr, amount, network, tx) {
        console.log("خرید جدید:", { address: addr, amount, network, tx, time: new Date().toLocaleString('fa-IR') });
        // بعداً اینجا به گوگل شیت یا تلگرام وب‌هوک می‌زنیم
    }
</script>

</body>
</html>
